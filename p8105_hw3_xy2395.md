p8105\_hw3\_xy2395
================
Jack Yan
10/04/2018

knitr::opts\_chunk$set( fig.width = 6, fig.asp = .6, out.width = "90%" )

``` r
library(tidyverse)
library(readxl)
library(p8105.datasets)
```

This homework includes figures; the readability of your embedded plots (e.g. font sizes, axis labels, titles) will be assessed in Problems 1+.

Problem 1
=========

Data Cleaning
-------------

The following code trunk

-   formats the data to use appropriate variable names using `clean_names()`,
-   focuses on the “Overall Health” topic using `filter()`,
-   include only responses from “Excellent” to “Poor” (i.e. no pre-collapsed categories), and
-   organizes responses as a factor taking levels from “Excellent” to “Poor”.

``` r
tidy_brfss = 
  brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health") %>% 
  select(-(class:question), -sample_size, -(confidence_limit_low : geo_location)) %>% 
  mutate(
    response = fct_relevel(response, c("Excellent", "Very good", "Good", "Fair", "Poor"))
    )
summary(tidy_brfss)
```

    ##       year      locationabbr       locationdesc            response   
    ##  Min.   :2002   Length:10625       Length:10625       Excellent:2125  
    ##  1st Qu.:2005   Class :character   Class :character   Very good:2125  
    ##  Median :2007   Mode  :character   Mode  :character   Good     :2125  
    ##  Mean   :2007                                         Fair     :2125  
    ##  3rd Qu.:2009                                         Poor     :2125  
    ##  Max.   :2010                                                         
    ##                                                                       
    ##    data_value   
    ##  Min.   : 0.40  
    ##  1st Qu.: 8.40  
    ##  Median :21.70  
    ##  Mean   :19.97  
    ##  3rd Qu.:30.30  
    ##  Max.   :51.10  
    ##  NA's   :28

Questions
---------

### Question 1

In 2002, which states were observed at 7 locations?

``` r
tidy_brfss %>% 
  filter(year == 2002) %>% 
  group_by(locationabbr) %>% 
  summarize(n_locations = n_distinct(locationdesc)) %>% 
  filter(n_locations == 7)
```

    ## # A tibble: 3 x 2
    ##   locationabbr n_locations
    ##   <chr>              <int>
    ## 1 CT                     7
    ## 2 FL                     7
    ## 3 NC                     7

CT, FL and NC were observed at 7 locations in 2002.

### Question 2

Make a “spaghetti plot” that shows the number of observations in each state from 2002 to 2010.

``` r
tidy_brfss %>% 
  group_by(locationabbr, year) %>% 
  count() %>% 
  ggplot(aes(x = year, y = n, color = locationabbr)) +
    geom_line() +
    labs(
      title = "Number of observations in each state",
      x = "Year",
      y = "Number of observations"
    ) 
```

![](p8105_hw3_xy2395_files/figure-markdown_github/unnamed-chunk-4-1.png)

### Question 3

Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.

``` r
tidy_brfss %>% 
  filter(year == 2002 | year == 2006 | year == 2010) %>% 
  filter(locationabbr == "NY") %>% 
  filter(response == "Excellent") %>% 
  group_by(year) %>% 
  summarize(
    mean = mean(data_value),
    sd = sd(data_value)
  ) %>% 
  gather(key = type_of_statistics, value = value, mean:sd) %>% 
  spread(key = year, value = value) %>% 
  knitr::kable(digits = 2, caption = "Mean and standard deviation of the proportion of “Excellent” responses across locations in NY State")
```

| type\_of\_statistics |   2002|   2006|   2010|
|:---------------------|------:|------:|------:|
| mean                 |  24.04|  22.53|  22.70|
| sd                   |   4.49|   4.00|   3.57|

### Question 4

For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.

``` r
tidy_brfss %>% 
  group_by(year, locationabbr, response) %>% 
  summarize(mean = mean(data_value, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = mean, color = response)) +
    geom_point() +
    facet_grid( ~ response) +
    theme(legend.position = "bottom", panel.spacing = unit(1, "lines")) 
```

![](p8105_hw3_xy2395_files/figure-markdown_github/unnamed-chunk-6-1.png)
